# Getting Started with Restia

## Requirements

This tutorial will assume you have

- A working installation of any Linux distro
- A working installation of [Openresty][openresty]
- Openrestys version of nginx in the PATH as `nginx`
- A working installation of Luarocks

## Creating a project

First of all, you will need to install Restia:

	$ luarocks install restia --dev --lua-version 5.1

After that, you can run `restia new` to create a new project,
passing it the directory where you want the project to be created:

	$ restia new application
	$ cd application

Now you can take a moment to inspect the directory structure.
This is also a good moment to create a git repository
and commit everything in the directory.
There's already a `.gitignore` file
so you don't commit anything unnecessary.

	$ git init
	$ git add --all
	$ git commit -m 'Initialize project ðŸŽ‰'

At this point you can already run your application:

	$ restia run
	
And open `http://localhost:8080/` in the browser
to be greeted with a plain but working website.

## Changing some things

The scaffolding application generated by `restia new` assumes a
Model-View-Controler structure. If necessary, this can be changed, of course.

Let's add a new page, `/greet`, which will greet the user.

First, we will create the `controllers/greeter.lua` file
with the following content:

	local config = require "config"
	local views = require "views"

	require('restia.controller').xpcall(function()
		return ngx.say(views.greeter { name = "Restia" })
	end, require 'error')

<details>
<summary>Restia looks for controllers in <code>/controllers</code></summary>
The default location block found in <code>locations/root</code> sets it up so that OpenResty
will search for controllers in the <code>controllers/</code> subdirectory automatically
unless another location matches the request first.
</details>

We could write our code directly in the controller file,
but the `restia.controller.xpcall` wrapper provides some features to make
it easier to solve errors.

The `config` and `views` modules are not part of the core restia library,
but are autogenerated modules in the `lib` subdirectory.

`restia.templates` is a table that automatically loads templates from files.
To create a simple template, simply create the file `views/greeter.cosmo` with the content:

	<h1>Hello from $name!</h1>

That's it! We can now run restia again.
This time though, let's keep it running in the background.

	$ restia test
	$ restia run &

Splendid!
But it's not 1990 anymore. Websites need to be international.
To make it easier to possibly translate the website in the future,
we will move the pages text into the i18n configuration.

For this, edit the file at `config/i18n/en.yaml`
and add a new section to the yaml file with a string like:

	title: My Website
	greeter:
		greeting: Hello from Restia!

now we go back to the controller at `controllers/greeter.lua`
and modify the line that renders the view to:

	return views.greeter { config.i18n.en }

and the view at `views/greeter.cosmo` to:

	<h1>$greeting</h1>

Should we ever want to translate our website into another language,
all we need to do is to add a new YAML file to the `config/i18n` folder
and mirror the english file.
then we can use any mechanism we likeâ€”from cookies over nginx regexp routes
to geolocation APIsâ€”to choose which language to render the site in.

Now all we need to do is reload the restia configuration

	$ restia reload
	
and reload the page in our browser.
It should look the same as before,
except now all the strings are fetched from the yaml file.

## Configuring more stuff

Configurations in restia are very simple:
the library allows "binding" directories into config tables.
Indexing such a table with a new key, will attempt to load a new
configuration entry by trying a series of handlers.
Handlers exist for YAML, JSON, and even for subdirectories (binding them as new
config tables).

so you can just throw any `json` file right into that
directory and it will be available as `require('config').<filename>`.

[openresty]: http://openresty.org/en/ 'OpenResty is a dynamic web platform based on NGINX and LuaJIT.'
